#!/usr/bin/env perl
use Mojolicious::Lite;

use lib 'lib';

#plugin 'MyAuth';
plugin 'DBAuth';
plugin 'bcrypt';  # Used in Mojolicious::Plugin::DBAuth

get '/' => sub { shift->render('login') };

under sub {
    my ($self) = @_;
    return 1
#        if $self->auth( 'gene', 'abc123' );     # MyAuth
        if $self->auth();                       # DBAuth
    $self->render( text => 'Denied!' );
    return 0;
};

post '/authcorp' => sub { shift->render( text => 'Welcome!' ) };

app->start;

__DATA__

@@login.html.ep
%= tag h1 => 'Login'
%= form_for '/authcorp' => (method => 'post') => begin
    Username: <%= text_field 'username' %>
    Password: <%= password_field 'password' %>
    %= submit_button 'Login'
%= end
